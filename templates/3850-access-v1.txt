no service pad
service timestamps debug datetime localtime show-timezone
service timestamps log datetime localtime show-timezone
service password-encryption
service compress-config
!
hostname {{hostName|upper}}
!
vrf definition Mgmt-vrf
 !
 address-family ipv4
 exit-address-family
 !
 address-family ipv6
 exit-address-family
!

{% include '/templates/commonBlocks/localCredentials.txt' %}

!
aaa new-model
!
!
aaa authentication login default group tacacs+ local
aaa authentication enable default group tacacs+ enable
aaa authorization exec default group tacacs+ local 
aaa authorization commands 15 default group tacacs+ local 
aaa accounting exec default start-stop group tacacs+
!
!
!
!
!
!
aaa session-id common
clock timezone CET 2 0
!

{# Calculate the number of switches in the stack and start from 1 instead of 0 #}
{% set numberSwitches = stackMembers| int +1 %}
{% for switch in range(1,numberSwitches) %}
switch {{ switch }} provision ws-c3850-48p
{%- endfor %}
!
ip device tracking
!
!
vtp domain {{ vtpDomain }}
vtp mode transparent
!
!
diagnostic bootup level minimal
!
spanning-tree mode rapid-pvst
spanning-tree portfast bpduguard default
spanning-tree extend system-id
!
redundancy
 mode sso
!
{% for vlan_name, vlan_id in vlans.iteritems() %}
vlan {{ vlan_id }}
 name {{ vlan_name }}
{%- endfor %}

!
lldp run
!
interface port-channel {{ uplinkPortChannel }}
 description Channel to {{ coreSwitchName }} - MONITOR
 {%- for vlan_name,vlan_id in vlans.iteritems() %}
 	switchport trunk allowed vlan add {{ vlan_id }}
 {%- endfor %}
 switchport mode trunk
!
interface GigabitEthernet0/0
 vrf forwarding Mgmt-vrf
 no ip address
 negotiation auto
!
interface range GigabitEthernet1/0/1 - 35
 description {{ siteCode }}-{{ floorNumber }}-{{ stackNumber }}
 switchport access vlan 310
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 switchport voice vlan 314
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet1/0/36 - 37
 description time-recording terminal
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet1/0/38
 description {{ siteCode }}-{{ floorNumber }}-AV
 switchport access vlan 316
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
!
interface range GigabitEthernet1/0/39 - 42
 description {{ siteCode }}-{{ floorNumber }}-w
 switchport trunk encapsulation dot1q
 switchport trunk native vlan 312
 switchport trunk allowed vlan 312,800,801
 switchport mode trunk
 logging event link-status
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet1/0/43 - 48
 description {{ siteCode }}-{{ floorNumber }}-p
 switchport access vlan 313
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet1/1/1
shutdown
!
interface GigabitEthernet1/1/2
shutdown
!
interface TenGigabitEthernet1/1/1
 shutdown
!
interface TenGigabitEthernet1/1/2
 shutdown
!
interface TenGigabitEthernet1/1/3
 description {{ coreSwitchName }} - MONITOR
 {%- for vlan_name,vlan_id in vlans.iteritems() %}
 	switchport trunk allowed vlan add {{ vlan_id }}
 {%- endfor %}
 switchport mode trunk
 channel-protocol pagp
 channel-group {{ uplinkPortChannel }} mode desirable
 no shutdown
!
interface TenGigabitEthernet1/1/4
 shutdown 
!
interface range GigabitEthernet2/0/1 - 35
 description {{ siteCode }}-{{ floorNumber }}-{{ stackNumber }}
 switchport access vlan 311
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 switchport voice vlan 315
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet2/0/36 - 37
 description time-recording terminal
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet2/0/38
 description {{ siteCode }}-{{ floorNumber }}-AV
 switchport access vlan 316
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
!
interface range GigabitEthernet2/0/39 - 42
 description {{ siteCode }}-{{ floorNumber }}-w
 switchport trunk encapsulation dot1q
 switchport trunk native vlan 312
 switchport trunk allowed vlan 312,800,801
 switchport mode trunk
 logging event link-status
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet2/0/43 - 48
 description {{ siteCode }}-{{ floorNumber }}-p
 switchport access vlan 313
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet2/1/1
 shutdown
!
interface GigabitEthernet2/1/2
 shutdown
!
interface TenGigabitEthernet2/1/1
 shutdown
!
interface TenGigabitEthernet2/1/2
 shutdown
!
interface TenGigabitEthernet2/1/3
 shutdown
!
interface TenGigabitEthernet2/1/4
 shutdown 
!
interface range GigabitEthernet3/0/1 - 35
 description {{ siteCode }}-{{ floorNumber }}-{{ stackNumber }}
 switchport access vlan 310
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 switchport voice vlan 314
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet3/0/36 - 37
 description time-recording terminal
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet3/0/38
 description {{ siteCode }}-{{ floorNumber }}-AV
 switchport access vlan 316
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
!
interface range GigabitEthernet3/0/39 - 42
 description {{ siteCode }}-{{ floorNumber }}-w
 switchport trunk encapsulation dot1q
 switchport trunk native vlan 312
 switchport trunk allowed vlan 312,800,801
 switchport mode trunk
 logging event link-status
 spanning-tree portfast
 no shutdown
!
interface range GigabitEthernet3/0/43 - 48
 description {{ siteCode }}-{{ floorNumber }}-p
 switchport access vlan 313
 switchport mode access
 no logging event link-status
 no snmp trap link-status
 spanning-tree portfast
 no shutdown
!
interface GigabitEthernet3/1/1
shutdown
!
interface GigabitEthernet3/1/2
shutdown
!
interface TenGigabitEthernet3/1/1
 shutdown
!
interface TenGigabitEthernet3/1/2
 shutdown
!
interface TenGigabitEthernet3/1/3
 description {{ coreSwitchName }} - MONITOR
 {%- for vlan_name,vlan_id in vlans.iteritems() %}
 	switchport trunk allowed vlan add {{ vlan_id }}
 {%- endfor %}
 switchport mode trunk
 channel-protocol pagp
 channel-group {{ uplinkPortChannel }} mode desirable
 no shutdown
!
!
interface TenGigabitEthernet3/1/4
 shutdown 
!
interface Vlan1
 no ip address
 shutdown
!
interface {{ mgmtVlan }}
 description Management interface
 ip address {{ mgmtIP }} {{ mgmtSM }}
 no ip route-cache
!
ip default-gateway {{ mgmtGW }}
no ip http server
no ip http authentication local
no ip http secure-server
ip tacacs source-interface {{ mgmtVlan }}
!
ip access-list extended MGT_ACCESS
 remark *** Orion Nodes ***
 permit tcp host 10.2.1.20 any eq telnet
 permit tcp host 10.3.1.30 any eq telnet
 permit tcp host 10.65.1.20 any eq telnet
 permit tcp host 10.129.1.20 any eq telnet
 remark *** Internal Networks ***
 permit tcp 10.0.0.0 0.255.255.255 any eq 22
 permit tcp 143.58.0.0 0.0.255.255 any eq 22
!
logging trap notifications
logging source-interface {{ mgmtVlan }}
logging host 10.2.1.52

{% include '/templates/commonBlocks/snmpACL.txt' %}
!
snmp-server community {{ snmpRW }} RW 98
snmp-server community {{ snmpRO }} RO 98
snmp-server location {{ snmpLocation }}
snmp-server contact netops@mayerbrown.com
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps cpu threshold
snmp-server enable traps tty
snmp-server enable traps ospf state-change
snmp-server enable traps ospf errors
snmp-server enable traps ospf retransmit
snmp-server enable traps ospf lsa
snmp-server enable traps ospf cisco-specific state-change nssa-trans-change
snmp-server enable traps ospf cisco-specific state-change shamlink interface
snmp-server enable traps ospf cisco-specific state-change shamlink neighbor
snmp-server enable traps ospf cisco-specific errors
snmp-server enable traps ospf cisco-specific retransmit
snmp-server enable traps ospf cisco-specific lsa
snmp-server enable traps flash insertion removal
snmp-server enable traps vtp
snmp-server enable traps vlancreate
snmp-server enable traps vlandelete
snmp-server enable traps license
snmp-server enable traps envmon fan shutdown supply temperature status
snmp-server enable traps stackwise
snmp-server enable traps port-security
snmp-server enable traps fru-ctrl
snmp-server enable traps entity
snmp-server enable traps config-copy
snmp-server enable traps config
snmp-server enable traps hsrp
snmp-server enable traps ipmulticast
snmp-server enable traps pim neighbor-change rp-mapping-change invalid-pim-message
snmp-server enable traps bridge newroot topologychange
snmp-server enable traps stpx inconsistency root-inconsistency loop-inconsistency
snmp-server enable traps syslog
snmp-server enable traps ipsla
snmp-server enable traps mac-notification change move threshold
snmp-server enable traps vlan-membership
snmp-server host 10.65.1.20 {{ snmpRO }} 
snmp-server host 10.65.1.20 {{ snmpRW }}  envmon entity config ipsla snmp

{% include '/templates/commonBlocks/tacacsConfig.txt' %}
!
{% include '/templates/commonBlocks/motdBanner.txt' %}
!
{% include '/templates/commonBlocks/lineConfigurations.txt' %}
!
{% include '/templates/commonBlocks/ntpServers.txt' %}
end